generator client {
  provider   = "prisma-client-js"
  engineType = "library" // or "binary" (either is fine on Node)
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum DiscountType {
  percentage
  fixed
}

enum DiscountCodeType {
  alpha
  numeric
  mixed
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)

  @@index([shop]) // speeds up lookups by shop
  @@index([expires]) // helps periodic cleanup of expired sessions
}

model tblkp_RepairEntryConditionReceived {
  id    Int    @id @default(autoincrement())
  value String

  @@map("repair_entry_condition_received")
}

model tblkp_RepairEntryPhotos {
  id    Int     @id @default(autoincrement())
  value Boolean

  @@map("repair_entry_photos")
}

model tblkp_RepairEntryDiagnosis {
  id    Int    @id @default(autoincrement())
  value String

  @@map("repair_entry_diagnosis")
}

model tblkp_RepairEntryDisposition {
  id    Int    @id @default(autoincrement())
  value String

  @@map("repair_entry_disposition")
}

model tblkp_RepairEntryReplacedItems {
  id    Int    @id @default(autoincrement())
  value String

  @@map("repair_entry_replaced_items")
}

model tblkp_RepairEntryFeedbackToCsd {
  id    Int    @id @default(autoincrement())
  value String

  @@map("repair_entry_feedback_to_csd")
}

model tblkp_RepairEntryReturnsRepairStatus {
  id    Int    @id @default(autoincrement())
  value String

  @@map("repair_entry_returns_repair_status")
}

model tblkp_RepairEntryReplacementItemDeliveryDate {
  id    Int      @id @default(autoincrement())
  value DateTime @db.Timestamptz(6)

  @@map("repair_entry_replacement_item_delivery_date")
}

model tblkp_CsdPrimaryCustomerReportedReasonForReturnWarranty {
  id    Int    @id @default(autoincrement())
  value String

  // back-relation → ReturnEntry.reasonCategory
  returnEntries ReturnEntry[] @relation("ReasonEntries")

  @@map("csd_primary_customer_reported_reason_for_return_warranty")
}

model tblkp_CsdItem {
  id    Int    @id @default(autoincrement())
  value String

  @@map("csd_item")
}

model tblkp_CsdReturnType {
  id    Int    @id @default(autoincrement())
  value String

  // back-relation → ReturnEntry.returnType
  returnEntries ReturnEntry[] @relation("ReturnTypeEntries")

  @@map("csd_return_type")
}

model tblkp_CsdTroubleshootingNotes {
  id    Int    @id @default(autoincrement())
  value String

  @@map("csd_troubleshooting_notes")
}

model tblkp_CsdCustomerServiceStatus {
  id    Int    @id @default(autoincrement())
  value String

  @@map("csd_customer_service_status")
}

model tblkp_staff {
  id   Int     @id @default(autoincrement())
  name String? @db.VarChar(60)
  role String? @db.VarChar(60)
  gid  String? @db.VarChar(60)

  @@map("rsl_staff")
}

model tblkp_CsdReturnItemRequired {
  id    Int     @id @default(autoincrement())
  value Boolean

  @@map("csd_return_item_required")
}

model tblkp_CsdRefundEligible {
  id    Int    @id @default(autoincrement())
  value String

  @@map("csd_refund_eligible")
}

model note {
  id              Int     @id @default(autoincrement())
  user_gid        String? @db.Text
  note            String? @db.Text
  return_entry_id Int?

  @@map("tbljn_note_departmentUserReturnEntry")
}

/**
 * Canonical Prisma model for DB table "return_entry".
 * (We renamed the Prisma model to PascalCase while keeping @@map so existing data is preserved.)
 */
model ReturnEntry {
  id                           Int       @id(map: "return_entry_pk") @default(autoincrement())
  date_requested               DateTime? @db.Date
  original_order               String    @db.Text // was @db.Char(1)
  original_order_gid           String?   @db.Text // was @db.Char(1)
  customer_name                String    @db.Text // was @db.Char(1)
  customer_gid                 String?   @db.Text // was @db.Char(1)
  primary_customer_reason_id   Int?
  item_id                      Int?
  return_type_id               Int?
  customer_service_status_id   Int?
  rsl_csr                      String?   @db.Text // was @db.Char(1)
  rsl_csr_gid                  String?   @db.Text // was @db.Char(1)
  return_item_required         Boolean?
  final_disposition_id         Int?
  date_received                DateTime? @db.Date
  repair_condition_received_id Int?
  date_inspected               DateTime? @db.Date
  rsl_rd_staff                 String?   @db.Text // was @db.Char(1)
  rsl_rd_staff_gid             String?   @db.Text
  replacement_order            String?   @db.Text
  replaced_items_todo          Int?
  status_id                    Int?
  serial_number                String?   @db.Text // was @db.Char(1)
  tracking_number              String?   @db.Text
  return_closed                Boolean?
  shopify_return_gid           String?   @db.Text

  // Named relations (unchanged)
  returnType     tblkp_CsdReturnType?                                     @relation("ReturnTypeEntries", fields: [return_type_id], references: [id])
  reasonCategory tblkp_CsdPrimaryCustomerReportedReasonForReturnWarranty? @relation("ReasonEntries", fields: [primary_customer_reason_id], references: [id])

  @@index([return_type_id])
  @@index([primary_customer_reason_id])
  @@map("return_entry")
}

model tbl_powerbuy_config {
  id                         Int               @id @default(autoincrement())
  powerbuy_uid               String?
  date_created               DateTime?         @db.Date
  created_by                 String?           @db.Text
  created_by_gid             String?           @db.Text
  title                      String?           @db.Text
  code_length                Int?
  code_type                  DiscountCodeType?
  short_description          String?           @db.Text
  long_description           String?           @db.Text
  request_email_subject      String?           @db.Text
  request_email_content      String?           @db.Text
  request_email_template_url String?           @db.Text
  confirm_email_subject      String?           @db.Text
  confirm_email_content      String?           @db.Text
  confirm_email_template_url String?           @db.Text
  rsl_contact_email_address  String?           @db.Text
  discount_prefix            String?           @db.Text
  discount_combines_with     String?           @db.Text
  start_time                 DateTime?         @db.Date
  end_time                   DateTime?         @db.Date
  duration                   String?           @db.VarChar()
  number_of_uses             Int?
  powerbuy_product_id        String?           @db.Text
  powerbuy_variant_ids       String?           @db.Text
  mailer_smtp_host           String?           @db.Text
  mailer_smtp_port           Int?
  mailer_smtp_user           String?           @db.Text
  mailer_smtp_pass           String?           @db.Text
  mailer_smtp_from_default   String?           @db.Text
  mailer_from_header         String?           @db.Text
  use_request_email_override Boolean?          @db.Boolean
  request_email_override     String?           @db.Text
  // NEW (optional)
  discount_type              DiscountType?
  discount_value             Decimal?          @db.Decimal(10, 2)
  allowed_stores             String?           @db.Text

  codes                 tbl_powerbuy_codes[]
  tbl_powerbuy_requests tbl_powerbuy_requests[]
}

model tbl_powerbuy_codes {
  id                        Int                     @id @default(autoincrement())
  powerbuy_id               Int
  powerbuy                  tbl_powerbuy_config     @relation(fields: [powerbuy_id], references: [id])
  discount_code             String                  @db.Text
  discount_code_gid         String                  @db.Text
  rsl_contact_email_address String?                 @db.Text
  start_time                DateTime?               @db.Timestamptz(6)
  end_time                  DateTime?               @db.Timestamptz(6)
  number_of_uses            Int?
  powerbuy_product_id       String?                 @db.Text
  requests                  tbl_powerbuy_requests[]

  @@index([powerbuy_id])
  @@index([discount_code])
}

model tbl_powerbuy_requests {
  id            Int                 @id @default(autoincrement())
  created_at    DateTime            @default(now())
  name          String
  email         String
  product_id    String
  powerbuy_id   Int
  token         String              @unique
  token_expires DateTime
  confirmed_at  DateTime?
  request_ip    String?
  code_id       Int?
  code          tbl_powerbuy_codes? @relation(fields: [code_id], references: [id], onDelete: SetNull, onUpdate: Cascade)
  powerbuy      tbl_powerbuy_config @relation(fields: [powerbuy_id], references: [id])

  @@index([email, powerbuy_id])
  @@index([code_id]) // optional but handy
}
